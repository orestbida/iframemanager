/*!
 * iframemanager v1.3.0
 * Author Orest Bida
 * Released under the MIT License
 */
(()=>{const e='api',t='click',o='{data-id}',n='accept',c='reject',i='c-h-n',s='c-h-b',r='show-ph';let a,l,f,d,v={},u={},m={},w={},p='',h={},b=[],_=new Map,g=e;const $=['onload','onerror','src','params'],S=e=>'function'==typeof e,x=e=>'string'==typeof e,T=e=>l.createElement(e),y=()=>T('div'),I=()=>{const e=T('button');return e.type='button',e},P=(e,t)=>e.className=t,D=(e,t)=>e.classList.add(t),M=(e,t)=>e.appendChild(t),k=e=>e&&Object.keys(e)||[],E=(e,t)=>{for(const o in t)N(e,o,t[o])},O=e=>{const t=e.dataset,o={},n='data-iframe-',c=e.getAttributeNames().filter((e=>e.slice(0,12)===n)).map((e=>e.slice(12))),i=e.querySelector('[data-placeholder]'),s=i&&i.hasAttribute('data-visible');s&&i.removeAttribute('data-visible');const r=i&&i.cloneNode(!0);for(const a of c)o[a]=e.getAttribute(n+a);return{t:t.id,o:t.title,i:t.thumbnail,l:t.params,v:e,u:null,m:i,p:r,h:null,_:!1,$:!1,S:!0,T:'widget'in t,I:s,P:o}},j=(e,t)=>{const o=v[e];'IntersectionObserver'in a&&(e=>{m[e]=new IntersectionObserver((n=>{for(const c of n)c.isIntersecting&&(C(t,o[c.target.dataset.index]),m[e].unobserve(c.target))}));for(const t of o)m[e].observe(t.v)})(e)},C=(e,t)=>{const n=e=>{t.h.style.backgroundImage=`url('${e}')`;const o=new Image;o.onload=()=>D(t.h,'loaded'),o.src=e};if(x(t.i))''!==t.i&&n(t.i);else if(S(e))e(t.t,(e=>n(e)));else if(x(e)){const c=e.replace(o,t.t);n(c)}},L=(e,t)=>{if(e._)return;if(e._=!0,e.m){const t=e.p.cloneNode(!0);e.m.replaceWith(t),e.m=t}const n=t.iframe;if(S(t.onAccept))return void t.onAccept(e.v,(t=>{if(!(t instanceof HTMLIFrameElement))return!1;E(t,n),E(t,e.P),e.D=t,e._=!0,D(e.v,s),(!e.I||e.T)&&D(e.v,r)}));e.D=T('iframe');const c=t.iframe,i=e.l||c&&c.params;let a=t.embedUrl||'';S(a)&&(a=String(a()));let l=a.replace(o,e.t);e.o&&(e.D.title=e.o),i&&x(i)&&(l+='?'===i.slice(0,1)?i:`?${i}`),e.D.onload=()=>{D(e.v,s),e.D.onload=void 0,S(n&&n.onload)&&n.onload(e.t,e.D)},E(e.D,n),E(e.D,e.P),e.D.src=l,M(e.u,e.D)},N=(e,t,o)=>{$.includes(t)||e.setAttribute(t,o)},A=e=>{D(e.v,i),e.S=!1},F=e=>{e.v.classList.remove(i,s,r),e.S=!0},G=e=>(e=l.cookie.match(`(^|;)\\s*${e}\\s*=\\s*([^;]+)`))?e.pop():'',H=(e,n,c)=>{const s=v[e],r=n.languages;s.forEach((s=>{if(!s.$&&r){const a=r[p],f=a&&a.loadBtn,d=a&&(a.notice||'').replace(o,s.t),v=a&&a.loadAllBtn,u=l.createElement('div'),m=y(),w=y(),h=y(),b=y();P(u,'cll'),s.u=u;const _=()=>{A(s),L(s,n)};if(f){const e=I();e.textContent=f,P(e,'c-l-b'),e.addEventListener(t,_),M(b,e)}if(v){const o=I();o.textContent=v,P(o,f?'c-la-b':'c-l-b'),o.addEventListener(t,(()=>{_(),g=t,K.acceptService(e)})),M(b,o)}const $=y(),S=y(),k=y(),E=y(),O=y();P($,'cc-text'),P(E,'c-bg-i'),s.h=E,P(k,'c-ld'),x(s.i)&&''===s.i||P(S,'c-bg');const j=s.o,C=l.createDocumentFragment();if(j){const e=T('span');P(e,'c-tl'),e.insertAdjacentHTML('beforeend',j),M(C,e)}M($,C),m&&$.insertAdjacentHTML('beforeend',d||''),M(w,$),P(O,'c-t-cn'),P(w,'c-n-t'),P(h,'c-n-c'),P(m,'c-nt'),P(b,'c-n-a'),M(O,w),(f||v)&&M(O,b),M(h,O),M(m,h),M(S,E),M(u,m),(n.thumbnailUrl||s.i)&&M(u,S),M(u,k),c&&D(s.v,i),s.v.prepend(u),s.$=!0,setTimeout((()=>D(s.v,'c-an')),20)}}))},J=(e,t)=>{const o=v[e];o.forEach((n=>{n._||((e,n)=>{u[n]||(u[n]=new IntersectionObserver((e=>{if(w[n])u[n].disconnect();else for(let c=0;c<e.length;++c)e[c].isIntersecting&&(c=>{const i=e[c].target,s=i.dataset.index;L(o[s],t),setTimeout((()=>{A(o[s])}),50*c),u[n].unobserve(i)})(c)}))),u[n].observe(e)})(n.v,e)}))},V=(e,t)=>e in t?e:k(t).length>0?p in t?p:k(t)[0]:void 0,W=(e,t)=>{const{cookie:o}=t;G(o.name)||(e=>{const{hostname:t,protocol:o}=location,n=e.name,c=new Date,i=e.path||'/',s=864e5*(e.expiration||182),r=e.sameSite||'Lax',a=e.domain||t;c.setTime(c.getTime()+s);let f=n+'=1'+(0!==s?`; Expires=${c.toUTCString()}`:'')+`; Path=${i}`+`; SameSite=${r}`;a.indexOf('.')>-1&&(f+=`; Domain=${a}`),'https:'===o&&(f+='; Secure'),l.cookie=f})(o),J(e,t)},q=(e,t)=>{const{cookie:o}=t;G(o.name)&&(e=>{const t=e.name,o=e.path||'/',n=e.domain||location.hostname;l.cookie=`${t}=; Path=${o}; Domain=${n}; Expires=Thu, 01 Jan 1970 00:00:01 GMT;`})(o),((e,t)=>{const o=v[e];for(let n=0;n<o.length;n++)(e=>{var n;o[e]._&&(S(t.onReject)?(t.onReject(o[e].D,o[e].v,(()=>F(o[e]))),o[e]._=!1):((n=o[e]).D&&n.D.remove(),n._=!1)),F(o[e])})(n)})(e,t)},z=(e,t,o)=>{S(d)&&d({eventSource:{type:g,service:e,action:t},changedServices:o})},B=e=>{if(e.hasAttribute('data-service')){e.removeAttribute('class'),e.removeAttribute('data-index');for(const t of e.children)t.hasAttribute('data-placeholder')||t.remove()}},K={acceptService:t=>{const o=[];if('all'===t){for(const e of b)w[e]=!1,_.get(e)||(_.set(e,!0),W(e,h[e]),o.push(e));o.length>0&&z(t,n,o)}else b.includes(t)&&(w[t]=!1,_.get(t)||(_.set(t,!0),W(t,h[t]),o.push(t),z(t,n,o)));g=e},rejectService:e=>{const t=[];if('all'===e){for(const e of b)w[e]=!0,q(e,h[e]),_.get(e)&&(_.set(e,!1),t.push(e));t.length>0&&z(e,c,t)}else b.includes(e)&&(w[e]=!0,q(e,h[e]),_.get(e)&&(_.set(e,!1),t.push(e),z(e,c,t)))},childExists:async({parent:e=a,childProperty:t,childSelector:o='iframe',timeout:n=1e3,maxTimeout:c=15e3})=>{let i=1;const s=t?()=>e[t]:()=>e.querySelector(o);return new Promise((e=>{const t=()=>{if(s()||i++*n>c)return e(void 0!==s());setTimeout(t,n)};t()}))},getState:()=>({services:new Map(_),acceptedServices:[..._].filter((([,e])=>!!e)).map((([e])=>e))}),getConfig:()=>f,reset:t=>{if(t)for(const e of b)for(const t of v[e])B(t.v);(()=>{for(const e of b)u[e]?.disconnect(),m[e]?.disconnect(),delete u[e],delete m[e];u={},m={},w={}})(),a=void 0,l=void 0,f=void 0,d=void 0,v={},p='',h={},b=[],_=new Map,g=e,window._imRun=!1},run:e=>{if(window._imRun)return;if(l=document,a=window,f=e,h=f.services,d=f.onChange,b=k(h),0===b.length)return;p=f.currLang;const t=h[b[0]].languages;!0===f.autoLang?p=V(navigator.language.slice(0,2).toLowerCase(),t):x(f.currLang)&&(p=V(f.currLang,t));for(const o of b){const e=h[o],t=e.cookie=e.cookie||{},n=t.name=t.name||`im_${o}`,c=G(n);_.set(o,!!c),v[o]=[];const i=l.querySelectorAll(`div[data-service="${o}"]`),s=i.length;if(0!==s){for(let e=0;e<s;e++)i[e].dataset.index=e,v[o].push(O(i[e]));c?(H(o,e,!0),J(o,e)):H(o,e,!1),j(o,e.thumbnailUrl)}}window._imRun=!0}},Q='iframemanager';'undefined'==typeof window||S(window[Q])||(window[Q]=()=>K)})();
